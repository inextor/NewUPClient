<div class="cart-container mt-5">
	<h2 class="app-page-title">Carrito de Compras</h2>

	<div class="card bg-white p-3">
		<div *ngIf="is_loading" class="text-center py-5">
			<div class="spinner-border text-primary" role="status">
				<span class="visually-hidden">Cargando...</span>
			</div>
		</div>

		<div *ngIf="!is_loading && cart_items.length === 0" class="text-center py-5">
			<p class="text-muted mb-3">Tu carrito está vacío</p>
			<a routerLink="/" class="btn btn-primary">Continuar Comprando</a>
		</div>

		<div *ngIf="!is_loading && cart_items.length > 0">
			<div class="table-responsive">
				<table class="table table-striped">
					<thead>
						<tr>
							<th>Producto</th>
							<th>Imagen</th>
							<th>Talla</th>
							<th>Cantidad</th>
							<th>Precio</th>
							<th>Subtotal</th>
							<th>Acciones</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let item of cart_items">
							<td>{{ item.ecommerce_item?.name || 'N/A' }}</td>
							<td>
								<img
									*ngIf="item.item_info?.item?.image_id"
									[src]="item.item_info.item.image_id | image"
									alt="{{ item.ecommerce_item?.name }}"
									style="width: 60px; height: 60px; object-fit: cover;"
								>
								<span *ngIf="!item.item_info?.item?.image_id" class="text-muted">Sin imagen</span>
							</td>
							<td>
								<span *ngIf="!item.isEditing">{{ item.variation === 'unico' ? 'Único' : item.variation }}</span>
								<select *ngIf="item.isEditing" class="form-select form-select-sm" [(ngModel)]="item.editVariation">
									<option *ngFor="let size of item.availableSizes" [value]="size">
										{{ size === 'unico' ? 'Único' : size }}
									</option>
								</select>
							</td>
							<td>
								<span *ngIf="!item.isEditing">{{ item.qty }}</span>
								<input *ngIf="item.isEditing" type="number" class="form-control form-control-sm" [(ngModel)]="item.editQty" min="1" style="width: 80px;">
							</td>
							<td>{{ item.ecommerce_item?.price || 0 | currency }}</td>
							<td>{{ (item.ecommerce_item?.price || 0) * (item.isEditing ? item.editQty || 0 : item.qty) | currency }}</td>
							<td>
								<div *ngIf="!item.isEditing" class="btn-group">
									<button
										class="btn btn-sm btn-outline-primary"
										(click)="startEdit(item)"
									>
										Editar
									</button>
									<button
										class="btn btn-sm btn-danger"
										(click)="removeFromCart(item.id)"
									>
										Eliminar
									</button>
								</div>
								<div *ngIf="item.isEditing" class="btn-group">
									<button
										class="btn btn-sm btn-success"
										(click)="saveEdit(item)"
									>
										Guardar
									</button>
									<button
										class="btn btn-sm btn-secondary"
										(click)="cancelEdit(item)"
									>
										Cancelar
									</button>
								</div>
							</td>
						</tr>
					</tbody>
					<tfoot>
						<tr>
							<td colspan="5" class="text-end"><strong>Total:</strong></td>
							<td colspan="2"><strong>{{ getTotalPrice() | currency }}</strong></td>
						</tr>
					</tfoot>
				</table>
			</div>

			<div class="mt-3 d-flex justify-content-between">
				<a routerLink="/" class="btn btn-outline-secondary">
					Continuar Comprando
				</a>
				<button
					class="btn btn-primary"
					[disabled]="isAnyItemEditing()"
					(click)="goToCheckout()"
				>
					Proceder al Checkout
				</button>
			</div>
		</div>
	</div>
</div>
